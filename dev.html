<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <style>
    .done {
      text-decoration: line-through;
    }
    #app.all .all,
    #app.remaining .remaining,
    #app.completed .completed {
      font-weight: bold
    }

    #app.remaining .todo.done {
      display: none;
    }

    #app.completed .todo:not(.done) {
      display: none;
    }

    .text {
      color: gray;
    }
    </style>
  </head>
  <body>
    <div id="app" class="all" sd-controller="TodoList">
      <div>
        <input placeholder="What needs to be done?" sd-on="change:addTodo">
      </div>
      <ul>
        <li class="todo" sd-each="todo:todos" sd-class="done:todo.done">
          <input type="checkbox" sd-checked="todo.done" sd-on="change:toggleTodo">
          <span sd-text="todo.title"></span>
          <a sd-on="click:removeTodo">X</a>
        </li>
      </ul>
      <div id="footer" sd-class="cls">
        Remaining: <span sd-text="remaining"></span><br>
        <a class="all" sd-on="click:filter">Show All</a> |
        <a class="remaining" sd-on="click:filter">Show Remaining</a> |
        <a class="completed" sd-on="click:filter">Show Completed</a>
      </div>
    </div>
    <script src="./dist/index.js"></script>

    <script>
      Seed.filter('money', (value, param) => {
        return '$' + value.toFixed(2)
      })

      Seed.controller('TodoList', function(scope) {
        scope.removeTodo = () => {
          let i = this.options.eachIndex
          scope.todos.splice(i, 1)
        }
        scope.toggleTodo = (e) => {
          scope.remaining += e.seed.scope.done ? -1 : 1
        }
        scope.filter = (e) => {
          let filter = e.el.className
          this.root.className = filter
        }
      })

      let todos = [{
        title: 'hello',
        done: true,
      }, {
        title: 'WoW',
        done: false,
      }, {
        title: 'test',
        done: false,
      }]

      let s = new Date()
      let app = new Seed('#app', {
        cls: 'text',
        remaining: todos.reduce((count, todo) => {
          return count + (todo.done ? 0 : 1)
        }, 0),
        addTodo(e) {
          let title = e.el.value
          if (title) {
            e.el.value = ''
            this.scope.todos.push({ title, done: false })
            this.scope.remaining++
          }
        },
        todos
      })
      console.log(Date.now() - s + 'ms')
    </script>
  </body>
</html>
